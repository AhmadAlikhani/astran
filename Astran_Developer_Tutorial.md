
```
<pre>

Sorry, it is google translated :( The original with pictures is in Portuguese in the Downloads section.


Tutorial to understand the code of the ASTRAN


Some conventions :
Class names : first letter of each word in Uppercase . Eg SaveLayout
Objects , methods , attributes and variables : Same classes except first letter lowercase. Eg supplyVSize
When making a data structure , the data ( primitive type or class structure ) is singular , while the container that includes data ( list , vector map, ... ) with the same name is only plural. Eg map <string, interface> interfaces ;
Iterators receive the name of the data structure at the end _it + . Eg : map :: iterator <string, interface> interfaces_it ;


￼
The icpdApp is where Astran execution starts . It is this class that receives the parameters passed from the command line and decides to run the graphical user interface ( class IcpdFrm ) or not ( class DesignMng ) .

￼

All windows graphical interface inherit from wxFrame . They are:
Design_Rules - Window with design rules
View_Preferences - Window preferences
View_Circuit - Window with the properties of circuit
CellGen - Window CellGen
ICPD_frm - Main Window tool ( I know it's not the best name , is holdover from the old implementation )
Help_About - Window Credits Tool
Specify_FP - Window to configure FloorPlaning

Files wxinterface.h / .cpp have the layout of all windows tool ( whose classes are shown above) and is automatically generated by the application wxFormBuilder ( http://wxformbuilder.org/?page_id=27 ) , do not try to modify them except for this tool . The design of the interfaces is in " / Project files / ICPD.fbp " . Use the File - > Generate Code to change the interfaces .
The classes that implement these interfaces are shown below in the figure, as subclasses . Each of these implementations often have a refresh method that is called to update their data .

The IcpdFrm class inherits fro ICPD_frm ( interface) and implements all the actions of the main window of the tool . This class is also responsible for instantiating and controlling all other windows tool . Finally , it is also responsible for instantiating the class DesignMng . Each button or selected option in the windows of the tool actually generates a command line that is sent directly to the shell of DesignMng .

The DesignMng class is responsible for ALL functionality . The idea is that by removing the GUI tool to keep 100 % functional by DesignMng . For this reason icpdApp instantiates it directly in case of running without a GUI .
The command interpreter has been developed to allow rapid addition / removal / modification of existing commands . A parser was provided for this.
To add a new command , just search the structure commands_lst [ ] in designmng.he add a new row with the syntax of the command and its description. A new entry in the type command_name with the constant that identifies this new command must be created in the same position in the previous list . The data types supported by the shell are <str_blah> , <int_blah> and <float_blah> . blah serves only to describe the parameter for the user to understand the help tool . Text between " " is counted as a single parameter , regardless of the number of spaces . Finally , just implement the new command on DesignMng :: readCommand int (string cmd ) , creating a case identifier assigned to the enumeration and observing proper return value ret .
Another function of this class is to instantiate all modules compoõem physical synthesis flow : circuit , router rules , placer , autocell . These objects are instantiated dynamically so they can be deleted and created again more easily . In addition , get methods were created to allow access graphical interface to each of these objects .

The Circuit class stores and processes all information related to circuit design : name, height band , top cell name , name of supply networks , interfaces , layouts , netlists and equations . Each of these latter data are identified by name in a map , so that a netlist layout is identified by ABC ABC ABC and equation . Methods to access ( get / set ) , search and insert each of these data above were implemented and should be used publicly .
Furthermore , Circuit also has methods to return statistical information about the circuit , and perform operations on your data as calculateCellsPins ( ) and getFlattenCell ( string name ) .

The structure declared in Circuit.cpp Interface stores the position , direction of the signal , and orientation ( netlist takes the spice ) from each end of the top of the circuit netlist .

The CLayout class stores the design of the corresponding hierarchical netlist . To implement this support to other instances layouts ( stored in the class Circuit) through a map of instances . It also stores the position of the pins and implements access methods and positioning and cleaning of such data .
Further details of CLayout is shown below:
￼
CLayout is a Box , because a layout has a behavior of a rectangle ( position, width and height ) , and is also a Draw because it is a drawing .
Draw in turn stores the design data and has methods to create / remove the rectangles .

The Instance class stores the name of the circuit that instantiates ( circuit stored in this Circuit) , inherits the Point pq has an assigned position , and mirroring mx , my.

The CellNetlst class stores the netlist which can be a cell or the top of the circuit. Each .SUBCKT is converted to an instance of CellNetlst and stored in the map cellNetlsts Circuit , including the top of the circuit . This is done pq top supports everything a . SUBCKT supports , being the top one bearing type . SUBCKT . For that it is necessary to inform the top of the circuit in Circuit for the correct functioning of the synthesis flow .
CellNetlst has functions to access / insert / change / remove transistors , instances and pins I / O netlist . It also keeps track of networks and where each one connects . Finally, methods have to calculate the ranking of the cell transistors .

The AutoCell class is instantiated in DesignMng and has functions to generate the layout of cells stored in Circuit netlists .

The Placer class is instantiated in DesignMng and has the functions to instantiate , treat , read and save the positioning of cells on top to circuit Circuit. After positioning , a layout with the cell name TOP + _PL containing the instances of all cells is added to the Circuit. This layout is then instantiated in the layout named TOP : PLACEMENT .

The Router class is instantiated in DesignMng and has functions to interpret the position stored in Placer , create the necessary data structure for routing and router to run the circuit on top Circuit. It also has methods to optimize , generate the layout , reading and saving routing. After running the routing + compression , a layout with the cell name TOP + _RT containing instances of all networks is added to the Circuit. This layout is then instantiated in the layout named TOP : ROUTING .

The Rules class is instantiated in DesignMng and stores the design rules as well as have the methods to access and modify this data .

The Spice class is instantiated by DesignMng and has functions to open and save files and calls the SPICE Circuit methods for querying and storing this information .

Class Size is instantiated by DesignMng and has functions to resize the cells of the top circuit .

The Verilog class is instantiated by DesignMng and has functions to read a Verilog file and convert to the internal data structures of Circuit.

Global and PathFinder classes are responsible for implementing the global routing algorithm and detailed circuit . PathFinder2 is responsible for intracell routing algorithm .

The Compaction class is responsible for implementing the algorithm solving linear equations with integer ( ILP ) .

The class SaveLayout receives the layout of a cell and saves Circuit in many formats : CIF , Sight and soon GDS (which for now has a separate class ) .

LEF class is instantiated possibly DesignMng and has functions to read and save libraries of layouts cells Circuit.

The file util.h has some utility functions that are used in various parts of the code such as : PrintHeader ( ) , ISNUMBER ( ) , fileExist ( ) , upcase , IntToStr ( ) , StrToInt ( ) , removeExt ( ) , GetFileName ( ) getExt ( ) , getPath , icpdExecute ( ) and a subclass of streambuf to redirect the standard output to the GUI of the ICPD / ASTRAN . This is done in the constructor of icpdfrm.cpp .
```